# EcoBin

EcoBin — веб-платформа для мотивации раздельного сбора отходов. Пользователь
сканирует QR-коды, получает баллы и обменивает их на товары в маркет-площадке.
Система интегрируется с устройством на базе Arduino UNO и камерой ноутбука,
которое автоматически определяет тип отхода и выдаёт код для начисления очков.

## Возможности

- Регистрация и авторизация пользователей. Администратор создаётся автоматически.
- Главный экран с персональным приветствием, текущим уровнем и прогрессом.
- Страница сканирования QR-кодов с поддержкой камеры и ручного ввода.
- Маркет с товарами, которые добавляет администратор через веб-интерфейс.
- Профиль пользователя с изменением имени, языка и пароля.
- REST API для выдачи наград, которое вызывается Arduino-скриптом.
- Генерация QR-кодов для начисления 100 баллов за бутылку и 50 — за бумагу.

## Быстрый старт

1. Установите зависимости:

   ```bash
   python -m venv .venv
   source .venv/bin/activate
   pip install -r requirements.txt
   ```

2. Запустите сервер разработки:

   ```bash
   flask --app app run --debug
   ```

   По умолчанию приложение доступно на `http://localhost:5000`.

3. Войдите под администратором (`admin` / `admin123`) и добавьте товары в маркет.

## Работа с Arduino

Для автоматического начисления баллов используйте скрипт `arduino_listener.py`:

```bash
python arduino_listener.py
```

Перед запуском укажите переменные окружения:

- `ECOBIN_SERIAL_PORT` — порт Arduino (`COM3`, `/dev/ttyACM0` и т.д.).
- `ECOBIN_API_URL` — адрес API (по умолчанию `http://localhost:5000/api/reward`).
- `ECOBIN_API_TOKEN` — ключ безопасности (совпадает с `ECOBIN_API_TOKEN` у сервера).
- `ECOBIN_CAMERA` — индекс камеры ноутбука, если подключено несколько устройств.

Скрипт ждёт сигнал от пина D5, делает снимок с камеры и отправляет запрос в API.
QR-код можно открыть по ссылке из ответа и показать пользователю для сканирования.

## Переменные окружения

| Переменная            | Назначение                                      | Значение по умолчанию |
|----------------------|-------------------------------------------------|-----------------------|
| `SECRET_KEY`         | Ключ сессии Flask                               | `dev-secret-key`      |
| `DATABASE_URL`       | Путь к базе данных                              | `sqlite:///ecobin.db` |
| `ECOBIN_API_TOKEN`   | Ключ доступа к API наград                       | `changeme`            |
| `ADMIN_USERNAME`     | Имя администратора                              | `admin`               |
| `ADMIN_PASSWORD`     | Пароль администратора                           | `admin123`            |
| `ADMIN_EMAIL`        | Email администратора                            | `admin@example.com`   |

## Лицензия

Проект предоставляется «как есть» исключительно для демонстрационных целей.
